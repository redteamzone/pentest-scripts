#!/usr/bin/env python3

import requests
import os 
from pyfiglet import Figlet

desenho  = Figlet(font='eftiwall')
banner_desenho = desenho.renderText('rtz')
fonte = Figlet(font='digital')
banner_fonte = fonte.renderText('CVE:2021-44228')
banner_fonte = fonte.renderText('Search Vulnerable Files in Codacy Repositories')

print(banner_desenho)
print(banner_fonte)
print('Create By: Carine Constantino\n') 
print('carine.constantino@hotmail.com')
print('----------------------------------------------------')
print('Exploit-DB: https://www.exploit-db.com/exploits/50592')
print('Exploit Authors: kozmer, z9fr, svmorris')
print('Github repo: https://github.com/kozmer/log4j-shell-poc\n')


def search_files():
    try:
        list_files = 'Path to repositories list'
        open_file = open(list_files,'r')
        for linha in open_file.readlines():
            url = linha.strip('\n')
            api = 'https://app.codacy.com/api/v3/organizations/[your-provider]/[your-organization]/repositories/{0}/files'.format(url) 
            print(api)
            headers = {'Accept': 'application/json','api-token': 'YOUR API TOKEN'}
            req = requests.request(method='GET', url=api, headers=headers)
            result = req.json()
            for i in result['data']:
                output = (i['path'])
                file_ext = os.path.splitext(output)
                if ".js" in file_ext: 
                    print(file_ext)
                elif ".jar" in file_ext:
                    print(file_ext)
                elif ".war" in file_ext:
                    print(file_ext)
                elif ".ear" in file_ext:
                    print(file_ext)
                elif ".zip" in file_ext:
                    print(file_ext)
    except ConnectionError as exc:
        raise RuntimeError('Repo List Fail') from exc
        
       
search_files()

